{% extends "base.html" %}

{% block title %}Admin - Software Catalog{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Admin Dashboard</h1>
    <div class="admin-header-actions">
        <a href="{{ url_for('admin.export_backup') }}" class="btn btn-outline">Export Backup</a>
        <button type="button" class="btn btn-outline" onclick="document.getElementById('importModal').classList.add('active')">Import Backup</button>
        <a href="{{ url_for('admin.add') }}" class="btn btn-primary">+ Add Software</a>
    </div>
</div>

<!-- Import Modal -->
<div id="importModal" class="confirm-overlay">
    <div class="confirm-dialog" style="max-width: 480px; text-align: left;">
        <h3>Import Backup</h3>
        <p>Upload a JSON backup file to import software entries.</p>
        <form method="POST" action="{{ url_for('admin.import_backup') }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="backup_file">Backup File (.json)</label>
                <input type="file" name="backup_file" id="backup_file" accept=".json" required
                       style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg); color: var(--color-text);">
            </div>
            <div class="form-group">
                <label>Import Mode</label>
                <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.35rem;">
                    <label class="form-check" style="font-weight: normal;">
                        <input type="radio" name="import_mode" value="merge" checked>
                        <span><strong>Merge</strong> &mdash; add new entries, skip duplicates</span>
                    </label>
                    <label class="form-check" style="font-weight: normal;">
                        <input type="radio" name="import_mode" value="replace">
                        <span><strong>Replace</strong> &mdash; clear all existing data first</span>
                    </label>
                </div>
            </div>
            <div class="form-actions" style="justify-content: flex-end;">
                <button type="button" class="btn btn-outline" onclick="document.getElementById('importModal').classList.remove('active')">Cancel</button>
                <button type="submit" class="btn btn-primary">Import</button>
            </div>
        </form>
    </div>
</div>

<div class="admin-table-wrapper">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Tagline</th>
                <th>DPA Status</th>
                <th>Featured</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for s in software %}
            <tr>
                <td><strong>{{ s.name }}</strong></td>
                <td style="max-width: 300px;">{{ s.tagline[:80] }}{% if s.tagline|length > 80 %}...{% endif %}</td>
                <td>
                    {% for c in s.categories if c.category_type == 'dpa_status' %}
                        <span class="badge badge-dpa_status" data-name="{{ c.name }}">{{ c.name }}</span>
                    {% endfor %}
                </td>
                <td>{% if s.featured %}Yes{% endif %}</td>
                <td>
                    <div class="admin-actions">
                        <a href="{{ url_for('admin.edit', software_id=s.id) }}" class="btn btn-sm btn-outline">Edit</a>
                        <form method="POST" action="{{ url_for('admin.delete', software_id=s.id) }}"
                              onsubmit="return confirm('Delete {{ s.name|e }}?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
